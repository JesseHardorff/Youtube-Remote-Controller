<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Player</title>
  </head>
  <body>
    <h1>Player</h1>

    <input type="text" id="messageInput" placeholder="Type a message" />
    <button id="sendButton">Send</button>
    <ul id="messages"></ul>
    <div id="player"></div>

    <script>
      const socket = new WebSocket("ws://localhost:8080");
      const input = document.getElementById("messageInput");
      const button = document.getElementById("sendButton");
      const messages = document.getElementById("messages");

      socket.addEventListener("message", async (event) => {
        const data = await event.data.text(); // Converteer Blob naar tekst

        console.log("Ontvangen WebSocket bericht:", data);

        let command = data.replace("Server: ", ""); // Verwijder eventuele prefix

        if (command === "playPause") {
          console.log("Play/Pause functie wordt aangeroepen");
          togglePlayPause();
        } else if (command === "skipForward") {
          console.log("+5 sec functie wordt aangeroepen");
          skipForward();
        } else if (command.length === 11) {
          // YouTube video ID's zijn 11 tekens lang
          console.log("Nieuwe video wordt geladen:", command);
          loadVideo(command);
        } else {
          console.warn("Onbekend commando ontvangen:", command);
        }
      });

      button.addEventListener("click", () => {
        const message = input.value;
        socket.send(message);
        input.value = "";
      });

      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      let player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player("player", {
          height: "390",
          width: "640",
          videoId: "M7lc1UVf-VE", // Default video
          playerVars: {
            playsinline: 1,
          },
        });
      }

      function togglePlayPause() {
        var state = player.getPlayerState();
        if (state === YT.PlayerState.PLAYING) {
          player.pauseVideo();
        } else {
          player.playVideo();
        }
      }

      function skipForward() {
        var currentTime = player.getCurrentTime();
        player.seekTo(currentTime + 5, true);
      }

      // Function to load a video into the player
      function loadVideo(videoId) {
        player.loadVideoById(videoId);
      }

      // Load default video initially
      function onPlayerReady(event) {
        event.target.playVideo();
      }

      var tag = document.createElement("script");
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName("script")[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
    </script>

    <button onclick="togglePlayPause()">Play/Pause</button>
    <button onclick="skipForward()">+5 sec</button>
  </body>
</html>
